<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>RED PRO | Social Hub</title>
    <style>
        :root { --red: #ff0000; --bg: #050000; --gold: #ffd700; --panel: #0c0c0c; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        nav { display: flex; justify-content: space-between; align-items: center; padding: 12px 5%; background: #000; border-bottom: 2px solid var(--red); }
        .btn { padding: 8px 18px; border: 1px solid var(--red); background: transparent; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: var(--red); box-shadow: 0 0 15px var(--red); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .window { width: 700px; padding: 25px; border: 1px solid var(--red); background: var(--panel); text-align: center; }

        /* SOSYAL SİSTEM */
        .social-box { display: flex; gap: 20px; height: 400px; margin-top: 15px; }
        .friend-list { flex: 1; background: #000; border: 1px solid #222; overflow-y: auto; padding: 10px; text-align: left; }
        .profile-side { width: 250px; background: #111; border: 1px solid var(--red); padding: 15px; display: flex; flex-direction: column; align-items: center; }

        .f-item { padding: 10px; background: #0a0a0a; margin-bottom: 5px; border-left: 3px solid var(--red); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .f-item:hover { background: #151515; }

        input { background: #111; border: 1px solid #333; color: white; padding: 10px; width: 100%; box-sizing: border-box; margin: 5px 0; }
        .id-badge { background: #222; padding: 2px 6px; font-size: 11px; color: #888; border-radius: 4px; }
        .pp-big { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--red); margin-bottom: 10px; object-fit: cover; }
    </style>
</head>
<body>

<nav>
    <div style="font-size: 24px; font-weight: bold; color: var(--red);">RED PRO <small style="color:white; font-size:10px;">SOCIAL</small></div>
    <div style="display:flex; gap:15px;">
        <span onclick="openV('lobbies')" style="cursor:pointer">LOBİLER</span>
        <span onclick="openV('social')" style="cursor:pointer">ARKADAŞLAR</span>
        <span id="nav-user" onclick="openV('profile_edit')" style="cursor:pointer; color:var(--red)"></span>
    </div>
</nav>

<div id="v-social" class="overlay">
    <div class="window">
        <h2 style="margin:0">SOSYAL PANEL</h2>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="add-friend-in" placeholder="Kod (#1234) veya İsim girin...">
            <button class="btn" style="width:auto" onclick="addFriend()">EKLE</button>
        </div>
        
        <div class="social-box">
            <div class="friend-list" id="friend-render">
                </div>
            <div class="profile-side" id="view-profile">
                <p style="color:#444">Profil detaylarını görmek için bir arkadaşına tıkla.</p>
            </div>
        </div>
        <button class="btn" onclick="closeV()">KAPAT</button>
    </div>
</div>

<div id="v-lobbies" class="overlay">
    <div class="window">
        <h2>AKTİF LOBİLER</h2>
        <div id="lobby-render" style="height:300px; overflow-y:auto; border:1px solid #222; margin-bottom:10px;"></div>
        <button class="btn" onclick="openV('create_lobby')">LOBİ KUR</button>
        <button class="btn" onclick="closeV()">İPTAL</button>
    </div>
</div>

<div id="v-login" class="overlay">
    <div class="window" style="width:350px;">
        <h2 class="animated-text">GİRİŞ YAP</h2>
        <input type="text" id="u-in" placeholder="Nick Seçin">
        <button class="btn" onclick="doLogin()">BAĞLAN</button>
    </div>
</div>

<script>
    const ADMINS = ["syvex", "tanrımbenibaştanyaratsın"];
    
    // --- TEMEL FONKSİYONLAR ---
    function openV(id) { closeV(); document.getElementById('v-'+id).style.display='flex'; if(id==='social') renderFriends(); if(id==='lobbies') renderLobbies();}
    function closeV() { document.querySelectorAll('.overlay').forEach(e=>e.style.display='none'); }

    // --- ARKADAŞLIK SİSTEMİ ---
    function generateID() {
        if(!localStorage.getItem('myID')) {
            let id = "#" + Math.floor(1000 + Math.random() * 9000);
            localStorage.setItem('myID', id);
        }
    }

    function addFriend() {
        let val = document.getElementById('add-friend-in').value;
        if(!val) return;
        let friends = JSON.parse(localStorage.getItem('my_friends') || "[]");
        if(friends.includes(val)) return alert("Zaten ekli!");
        
        friends.push(val);
        localStorage.setItem('my_friends', JSON.stringify(friends));
        renderFriends();
        document.getElementById('add-friend-in').value = "";
    }

    function renderFriends() {
        const div = document.getElementById('friend-render');
        div.innerHTML = "";
        let friends = JSON.parse(localStorage.getItem('my_friends') || "[]");
        
        friends.forEach(f => {
            div.innerHTML += `
                <div class="f-item" onclick="viewUser('${f}')">
                    <span>${f}</span>
                    <span style="color:green; font-size:10px;">● Çevrimiçi</span>
                </div>`;
        });
    }

    function viewUser(name) {
        const side = document.getElementById('view-profile');
        let pp = localStorage.getItem('pp_' + name) || "https://i.imgur.com/6VBx3io.png";
        // Simüle kod: İsimden kod üretme (Gerçek sistemde DB'den gelir)
        let fakeID = "#" + (name.length * 1234 % 9999); 
        
        side.innerHTML = `
            <img src="${pp}" class="pp-big">
            <h3 style="margin:0">${name}</h3>
            <span class="id-badge">${name.includes('#') ? name : fakeID}</span>
            <div style="margin-top:20px; width:100%;">
                <button class="btn" style="width:100%; font-size:11px;" onclick="alert('Mesaj gönderildi')">MESAJ AT</button>
                <button class="btn" style="width:100%; font-size:11px; border-color:orange; margin-top:5px;" onclick="removeFriend('${name}')">ARKADAŞLIKTAN ÇIKAR</button>
            </div>
        `;
    }

    function removeFriend(name) {
        let friends = JSON.parse(localStorage.getItem('my_friends'));
        let filtered = friends.filter(f => f !== name);
        localStorage.setItem('my_friends', JSON.stringify(filtered));
        renderFriends();
        document.getElementById('view-profile').innerHTML = '<p style="color:#444">Silindi.</p>';
    }

    // --- LOBİ SYNC (KESİN ÇÖZÜM) ---
    function renderLobbies() {
        const div = document.getElementById('lobby-render');
        div.innerHTML = "";
        // Global havuzdan çekiyoruz
        let pool = JSON.parse(localStorage.getItem('RED_GLOBAL_POOL') || "[]");
        pool.forEach(l => {
            div.innerHTML += `
                <div style="padding:12px; background:#111; margin:5px; display:flex; justify-content:space-between; border-left:2px solid var(--red);">
                    <span><b>${l.name}</b> <small style="color:#666">(${l.host})</small></span>
                    <button class="btn" style="padding:4px 10px" onclick="alert('Katılınıyor...')">KATIL</button>
                </div>`;
        });
    }

    // --- LOGIN ---
    function doLogin() {
        let u = document.getElementById('u-in').value;
        if(!u) return;
        localStorage.setItem('user', u);
        localStorage.setItem('isLogged', 'true');
        generateID();
        location.reload();
    }

    window.onload = () => {
        if(localStorage.getItem('isLogged')) {
            let u = localStorage.getItem('user');
            let id = localStorage.getItem('myID');
            document.getElementById('nav-user').innerText = u + " " + id;
        } else {
            openV('login');
        }
    };

    // ARKADAŞININ LOBİSİNİ GÖRMEN İÇİN HER 1 SANİYEDE BİR HAVUZU KONTROL ET
    setInterval(() => {
        if(document.getElementById('v-lobbies').style.display === 'flex') renderLobbies();
    }, 1000);

</script>
</body>
</html>
